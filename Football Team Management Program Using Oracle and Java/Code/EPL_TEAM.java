package EPLTEAM;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.Scanner;

public class EPL_TEAM {

	Scanner scan = new Scanner(System.in);  // 각 메소드별 중복되는 항목 빼냄.
	Scanner scan2 = new Scanner(System.in);
	String driver = "oracle.jdbc.driver.OracleDriver"; 
	String url = "jdbc:oracle:thin:@localhost:1521:orcl";
	
		public void selectMethod() {
			String sql = "select T.T_CODE, T.T_NAME, M.M_NAME, T.M_CODE from team T, manager M WHERE T.M_CODE = M.M_CODE";
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀 코드 \t팀 명 \t\t감독 명\t감독 코드");
			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamcode = rs.getString("T_CODE"); 
					String teamname = rs.getString("T_NAME"); 
					String managername = rs.getString("M_NAME");	
					String managercode = rs.getString("M_CODE"); 
					System.out.println(teamcode + "\t" + teamname +  "\t\t" + managername + "\t\t" + managercode);
				}
			}		
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}
	
		public void updateMethod() {	// 팀 정보 수정		
			String sql = "UPDATE TEAM SET M_CODE = ? WHERE T_CODE = ?";	
			Connection con = null;
			PreparedStatement pstmt = null;		
			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				
				System.out.printf("수정할 팀의 코드 입력: ");
				String teamcode = scan.next();
				System.out.printf("수정할 감독코드 입력: ");
				String managercode = scan2.next();		
				
				pstmt.setString(1, managercode);
				pstmt.setString(2, teamcode);
				int cnt = pstmt.executeUpdate(); 
				System.out.println(cnt + "건이 실행되었습니다.");
			}
			catch (Exception e) {System.out.println(e.getMessage());}
			finally {
				try {				
					pstmt.close();
					con.close();
				} catch (Exception e) {
				}
			}
		}
	

	
		public void deleteMethod() {	// 팀 삭제
			String sql = "DELETE FROM TEAM WHERE T_CODE = ?";
			String teamcode = "";
			
			Connection con = null;
			PreparedStatement pstmt = null;		
			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				
				System.out.print("삭제할 팀코드를 입력하시오: ");
				teamcode = scan.next();
				
				pstmt.setString(1, teamcode);
				int cnt = pstmt.executeUpdate(); 
				System.out.println(cnt + "건이 실행되었습니다.");	
				//System.out.println(cnt);
			}
			catch (Exception e) {System.out.println(e.getMessage());}
			finally {
				try {
					pstmt.close();
					con.close();
				} catch (Exception e) {
				}
			}
		}
	
	


		public void insertMethod() {		
			String sql = "INSERT INTO TEAM(T_CODE,T_NAME,M_CODE) VALUES(?, ?, ?)";			
			Connection con = null;
			PreparedStatement pstmt = null;
			
			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				
				System.out.printf("입력할 팀코드: ");
				String teamcode = scan.next();
				System.out.printf("입력할 팀명: ");
				String teamname = scan2.nextLine();			
				System.out.printf("입력할 감독코드: ");
				String managercode = scan2.nextLine();			
				
				pstmt.setString(1, teamcode);
				pstmt.setString(2, teamname);
				//pstmt.setInt(3, price);
				pstmt.setString(3, managercode);
				int cnt = pstmt.executeUpdate(); 
				System.out.println(cnt + "건이 실행되었습니다.");			
			}
			catch (Exception e) {System.out.println(e.getMessage());}
			finally {
				try {
					pstmt.close();
					con.close();
				} catch (Exception e) {
				}
			}
		}
		
///////////////////////////////////////////////////////////////////////////////////////////////////////질의문
		
		public void textra_round() {		
			System.out.println("");
			System.out.println("[[원하는 메뉴를 선택하십시오.]]");
			System.out.println("");
			System.out.println("┎ A.팀별 감독 검색");
			System.out.println("┃");
			System.out.println("┠ B.팀별 급여 평균");
			System.out.println("┃     ┖ B1. 팀 전체");
			System.out.println("┃     ┖ B2. 골키퍼");
			System.out.println("┃     ┖ B3. 수비수");
			System.out.println("┃     ┖ B4. 미드필더");
			System.out.println("┃     ┖ B5. 공격수");
			System.out.println("┃");
			System.out.println("┠ C.팀별 선수 연령대");
			System.out.println("┃");
			System.out.println("┠ D.팀별 장신 선수 검색");
			System.out.println("┃");
			System.out.println("┠ E.팀 보더진 검색");
			System.out.println("┃");
			System.out.println("┠ F.팀 코치진 검색");
			System.out.println("┖ ");
			
			System.out.print("=> ");
			String sel = scan.next();
			
			if(sel.equals("A")){
				String sql = "SELECT e.t_name, m.m_name, m.m_contract, m.m_nationality "
						+ "FROM team E, manager M "
						+ "WHERE E.M_CODE = M.M_CODE";
				Connection con = null;
				PreparedStatement pstmt = null;
				ResultSet rs = null;
				
				System.out.println("팀 명 \t\t감독 이름 \t\t계약 기간 \t국적");
				System.out.println("───────────────────────────────────────────────────────────");

				try {
					Class.forName(driver);
					con = DriverManager.getConnection(url, "pjh", "2015150046");
					pstmt = con.prepareStatement(sql);
					rs = pstmt.executeQuery(); 
					while (rs.next()) {
						String timename = rs.getString("T_NAME"); 
						String managername = rs.getString("M_NAME"); 
						String managercontract = rs.getString("m_CONTRACT");
						String managernationality = rs.getString("M_nationality");	
						System.out.println(timename + "\t\t" + managername + "\t\t" + managercontract
								+ "\t" + managernationality) ;
					}
				}		
				catch (Exception e) {System.out.println(e.getMessage());}		
				finally {
					try {rs.close();
						pstmt.close();
						con.close();
					} catch (Exception e) {}
				}
			}//sel=A
		
		if(sel.equals("B1")){
			String sql = "SELECT e.t_name, round(avg(p.p_pay),0), max(p.p_pay), min(p.p_pay) "
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "GROUP BY e.t_name "
					+ "ORDER BY avg(p.p_pay) desc" ;					
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명 \t\t선수 평균 급여 \t선수 최고 급여 \t선수 최저 급여");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					long playerpay = rs.getLong("round(avg(p.p_pay),0)");
					long managercontract = rs.getLong("max(p.p_pay)");
					long managernationality = rs.getLong("min(p.p_pay)");	
					System.out.println(teamname + "\t\t" + playerpay+ "\t" + managercontract + "\t" + managernationality) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=B1
		
		if(sel.equals("B2")){
			String sql = "SELECT e.t_name, p.p_position, ROUND(avg(p.p_pay),0), max(p.p_pay), min(p.p_pay)"
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "and p.p_position ='GK' "
					+ "GROUP BY e.t_name, p.p_position "
					+ "ORDER BY avg(p.p_pay) desc" ;
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명\t\t포지션\t\t선수 평균 급여 \t선수 최고 급여 \t선수 최저 급여");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String playerposition = rs.getString("p_position"); 
					long playerpay = rs.getLong("round(avg(p.p_pay),0)");
					long managercontract = rs.getLong("max(p.p_pay)");
					long managernationality = rs.getLong("min(p.p_pay)");	
					System.out.println(teamname + "\t\t" + playerposition + "\t\t" + playerpay+ "\t" 
								+ managercontract + "\t" + managernationality) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=B2
		
		if(sel.equals("B3")){
			String sql = "SELECT e.t_name, p.p_position, ROUND(avg(p.p_pay),0), max(p.p_pay), min(p.p_pay)"
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "and p.p_position ='DF' "
					+ "GROUP BY e.t_name, p.p_position "
					+ "ORDER BY avg(p.p_pay) desc" ;
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명\t\t포지션\t\t선수 평균 급여 \t선수 최고 급여 \t선수 최저 급여");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String playerposition = rs.getString("p_position"); 
					long playerpay = rs.getLong("round(avg(p.p_pay),0)");
					long managercontract = rs.getLong("max(p.p_pay)");
					long managernationality = rs.getLong("min(p.p_pay)");	
					System.out.println(teamname + "\t\t" + playerposition + "\t\t" + playerpay+ "\t" 
								+ managercontract + "\t" + managernationality) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=B3
		
		if(sel.equals("B4")){
			String sql = "SELECT e.t_name, p.p_position, ROUND(avg(p.p_pay),0), max(p.p_pay), min(p.p_pay)"
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "and p.p_position ='MF'"
					+ "GROUP BY e.t_name, p.p_position "
					+ "ORDER BY avg(p.p_pay) desc" ;
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명\t\t포지션\t\t선수 평균 급여 \t선수 최고 급여 \t선수 최저 급여");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String playerposition = rs.getString("p_position"); 
					long playerpay = rs.getLong("round(avg(p.p_pay),0)");
					long managercontract = rs.getLong("max(p.p_pay)");
					long managernationality = rs.getLong("min(p.p_pay)");	
					System.out.println(teamname + "\t\t" + playerposition + "\t\t" + playerpay+ "\t" 
								+ managercontract + "\t" + managernationality) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=B4
		
		if(sel.equals("B5")){
			String sql = "SELECT e.t_name, p.p_position, ROUND(avg(p.p_pay),0), max(p.p_pay), min(p.p_pay)"
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "and p.p_position in ('FW', 'ST')"
					+ "GROUP BY e.t_name, p.p_position "
					+ "ORDER BY avg(p.p_pay) desc" ;
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명\t\t포지션\t\t선수 평균 급여 \t선수 최고 급여 \t선수 최저 급여");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String playerposition = rs.getString("p_position"); 
					long playerpay = rs.getLong("round(avg(p.p_pay),0)");
					long managercontract = rs.getLong("max(p.p_pay)");
					long managernationality = rs.getLong("min(p.p_pay)");	
					System.out.println(teamname + "\t\t" + playerposition + "\t\t" + playerpay+ "\t" 
								+ managercontract + "\t" + managernationality) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=B5
		
		if(sel.equals("C")){
			String sql = "SELECT e.t_name, ROUND(avg(p.p_age),0), max(p.p_age), min(p.p_age)"
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "GROUP BY e.t_name";
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명 \t\t선수 평균 나이 \t선수 최고 나이 \t선수 최저 나이");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String playerage = rs.getString("round(avg(p.p_age),0)");
					String maxplayerage = rs.getString("max(p.p_age)");
					String minplayerage = rs.getString("min(p.p_age)");	
					System.out.println(teamname + "\t\t" + playerage+ "\t\t" + maxplayerage + "\t\t" + minplayerage) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=C
		
		if(sel.equals("D")){
			String sql = "SELECT e.t_name, p.p_name, p.p_cm, p.p_kg, p.p_position, p.p_age,  p.p_pay, p.p_nationality "
					+ "FROM player p, team e "
					+ "WHERE e.t_code= p.t_code "
					+ "AND p_cm > "
					+ "(SELECT avg(p_cm) "
					+ "FROM player "
					+ "WHERE t_code= p.t_code)";
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명 \t\t선수 명 \t신장\t체중\t포지션\t나이\t급여\t\t국적");
			System.out.println("────────────────────────────────────────────────────────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				pstmt = con.prepareStatement(sql);
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String playername = rs.getString("P_NAME");
					String playercm = rs.getString("p_cm"); 
					String playerkg = rs.getString("p_kg"); 
					String playerposition = rs.getString("P_POSITION"); 
					String playerage = rs.getString("P_AGE");
					String playerpay = rs.getString("P_pay"); 
					String playernationality = rs.getString("P_nationality"); 
					String teamname = rs.getString("T_NAME");  
					
					System.out.println(teamname + "\t\t" + playername + "\t" + playercm+ "\t" + playerkg + "\t" + playerposition 
							+ "\t" + playerage + "\t" + playerpay  + "\t" + playernationality) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=D
		
		if(sel.equals("E")){
			System.out.printf("팀 코드 입력: ");
			String tcode = scan.next();
			
			String sql = "select t.t_name, b.b_name, b.b_position from board b, team t where b.t_code=t.t_code and t.t_code LIKE ?";
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명 \t\t보더 이름 \t\t보더 직위");
			System.out.println("────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				
				pstmt = con.prepareStatement(sql);
				pstmt.setString(1, tcode);
				
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String boardname = rs.getString("B_NAME");
					String boardposition = rs.getString("B_POSITION");
					System.out.println(teamname + "\t" + boardname+ "\t\t" + boardposition) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=E
		
		if(sel.equals("F")){
			System.out.printf("팀 코드 입력: ");
			String bposition = scan.next();
			
			String sql = "select t.t_name, c.c_name, c.c_position from coach c, team t where c.t_code=t.t_code and t.t_code LIKE ?";
			Connection con = null;
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			System.out.println("팀명 \t\t코치 이름 \t\t코치 직위");
			System.out.println("────────────────────────────────────────────");

			try {
				Class.forName(driver);
				con = DriverManager.getConnection(url, "pjh", "2015150046");
				
				pstmt = con.prepareStatement(sql);
				pstmt.setString(1, bposition);
				
				rs = pstmt.executeQuery(); 
				while (rs.next()) {
					String teamname = rs.getString("T_NAME"); 
					String coachname = rs.getString("C_NAME");
					String coachposition = rs.getString("C_POSITION");
					System.out.println(teamname + "\t" + coachname+ "\t\t" + coachposition) ;
				}
			}	
			catch (Exception e) {System.out.println(e.getMessage());}		
			finally {
				try {rs.close();
					pstmt.close();
					con.close();
				} catch (Exception e) {}
			}
		}//sel=F
		
	} //질의 괄화
} //전체 괄호
